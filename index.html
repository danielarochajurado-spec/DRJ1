<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DDgame Host</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 10%;
      background: #f7f7f7;
    }
    .hidden { display: none; }
    input, button {
      font-size: 18px;
      padding: 10px;
      margin: 10px;
    }
    button { cursor: pointer; border-radius: 8px; }
    ul { list-style-type: none; padding: 0; }
    li { margin: 10px; font-size: 18px; }
  </style>
</head>
<body>
  <!-- Language selection -->

  <div id="languageScreen">
    <h1>Select Language / Seleccione el idioma / Selecione o idioma</h1>
    <button onclick="setLanguage('en')">English</button>
    <button onclick="setLanguage('es')">Español</button>
    <button onclick="setLanguage('pt')">Português</button>
  </div>

  <!-- Login -->
  <div id="loginScreen" class="hidden">
    <h1 id="loginTitle">Enter Participant ID</h1>
    <input id="participantId" type="text" placeholder="e.g., P001" />
    <br />
    <button id="continueBtn" onclick="startSession()">Continue</button>
  </div>

  <!-- Menu -->
  <div id="menuScreen" class="hidden">
    <h1 id="menuTitle">Select a Task</h1>
    <ul id="taskList"></ul>
  </div>

  <!-- Firebase and App logic -->
  <script type="module">
    // === FIREBASE SETUP ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBdiRWxsnpS55ZhgVAMR89FP7DTXOQ4WiA",
        authDomain: "discountinggame.firebaseapp.com",
        projectId: "discountinggame",
        storageBucket: "discountinggame.firebasestorage.app",
        messagingSenderId: "497209908113",
        appId: "1:497209908113:web:6e36f40f63b8154a44d830"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

      // === TASKS ===
    const tasks = [
      { 
        id: 'DDgame', 
        name: { en: 'Experiential DDgame', es: 'DDgame experiencial', pt: 'DDgame experiencial' },
        fileByLang: { en: 'DDgameEnglish.html', es: 'DDgameEsp.html', pt: 'DDgame.html' }
      },
      { 
        id: 'hypoDDGame', 
        name: { en: 'Hypothetical DDgame', es: 'DDgame hipotético', pt: 'DDgame hipotético' },
        fileByLang: { en: 'hypoEnglish.html', es: 'hypoEsp.html', pt: 'hypoDDGame.html' }
      },
      { 
        id: 'Monetary', 
        name: { en: 'Monetary DDgame', es: 'DDgame monetario', pt: 'DDgame monetário' },
        fileByLang: { en: 'MonetaryEnglish.html', es: 'MonetaryEsp.html', pt: 'Monetary.html' }
      }
    ];

    let participantId = null;
    let participantData = {};
    let language = 'en'; // default

    // === LANGUAGE SELECTION ===
    function setLanguage(lang) {
      language = lang;
      document.getElementById('languageScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');

      // Cambiar textos de login según idioma
      const loginTitle = {
        en: 'Enter Participant ID',
        es: 'Ingrese ID del participante',
        pt: 'Digite o ID do participante'
      };
      const continueText = {
        en: 'Continue',
        es: 'Continuar',
        pt: 'Continuar'
      };
      document.getElementById('loginTitle').innerText = loginTitle[language];
      document.getElementById('continueBtn').innerText = continueText[language];
    }

    // === START SESSION ===
    async function startSession() {
      const pid = document.getElementById('participantId').value.trim();
      if (!pid) return alert('Please enter a participant ID.');
      participantId = pid;

      const ref = doc(db, "participants", participantId);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        participantData = snap.data();
        console.log("Loaded data:", participantData);
      } else {
        participantData = { completed: {} };
        await setDoc(ref, participantData);
      }
      showMenu();
    }

    // === SHOW MENU ===
    function showMenu() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('menuScreen').classList.remove('hidden');

      const menuTitles = {
        en: 'Select a Task',
        es: 'Seleccione una tarea',
        pt: 'Selecione uma tarefa'
      };
      document.getElementById('menuTitle').innerText = menuTitles[language];

      const list = document.getElementById('taskList');
      list.innerHTML = '';
      tasks.forEach(task => {
        const done = participantData.completed[task.id];
        const li = document.createElement('li');
        li.innerHTML = `
          <button onclick="startTask('${task.id}')">
            ${task.name[language]} ${done ? '✅' : ''}
          </button>
        `;
        list.appendChild(li);
      });
    }

    // === START TASK ===
    window.startTask = (taskId) => {
      const task = tasks.find(t => t.id === taskId);
      const file = task.fileByLang[language];  // Selecciona el archivo según idioma
      localStorage.setItem('participantId', participantId);
      localStorage.setItem('currentTask', taskId);
      window.location.href = file;
    };

    // Hacer accesibles al window para los botones
    window.startSession = startSession;
    window.setLanguage = setLanguage;
  </script>

</body>
</html>
